- id: alarm_armed_away
  alias: '[Alarm] Modo ausente'
  trigger:
    platform: state
    entity_id: alarm_control_panel.alarma
    to: 'armed_away'
  action:
  - service: notify.ios_iphone_de_cristian
    data:
      message: 'La alarma ha sido activada en modo Ausente, adiós'
  - service: shell_command.sirena_bip_arm

- id: alarm_armed_home
  alias: '[Alarm] Modo Presente'
  trigger:
    platform: state
    entity_id: alarm_control_panel.alarma
    to: 'armed_home'
  action:
  - service: notify.ios_iphone_de_cristian
    data:
      message: 'La alarma ha sido activada en modo Presente, adiós'
  - service: shell_command.sirena_bip_arm

- id: alarm_disarmed
  alias: '[Alarm] Desarmada'
  trigger:
    platform: state
    entity_id: alarm_control_panel.alarma
    to: 'disarmed'
  action:
  - service: notify.ios_iphone_de_cristian
    data:
      message: 'La alarma ha sido desactivada.'
  - service: shell_command.sirena_bip_disarm
     
- id: alarm_triggered
  alias: '[Alarm] Alarma detectada'
  trigger:
    platform: state
    entity_id: alarm_control_panel.alarma
    to: 'triggered'
  action:
  - service: shell_command.sirena
  - service: notify.ios_iphone_de_cristian
    data:
      message: 'ALARMA DETECTADA!!! {{ states[states.alarm_control_panel.alarma.attributes.changed_by.split(".")[0]][ states.alarm_control_panel.alarma.attributes.changed_by.split(".")[1]].name }}'
  - delay: '00:05:00'
  - service: shell_command.sirena_bip_disarm

- id: alarm_detect
  alias: '[Alarm] Lanzar alarma si esta activada en MODO AUSENTE'
  trigger:
    - platform: state
      entity_id: binary_sensor.pir_comedor
      to: 'on'
    - platform: state
      entity_id: binary_sensor.pir_logia
      to: 'on'
    - platform: state
      entity_id: binary_sensor.pir_escalera
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: armed_away
  action:
    service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.alarm

- id: alarm_detect
  alias: '[Alarm] Lanzar alarma si esta activada en MODO PRESENTE'
  trigger:
    - platform: state
      entity_id: binary_sensor.pir_comedor
      to: 'on'
    - platform: state
      entity_id: binary_sensor.pir_logia
      to: 'on'
    - platform: state
      entity_id: binary_sensor.pir_escalera
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.alarm
      state: armed_home
  action:
    service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.alarm
